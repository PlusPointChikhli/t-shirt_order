<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PlusPoint-Chinese Collar T‑Shirt – Order Form</title>
  <style>
    :root{
      --bg: #0d0d0d;
      --card: #1c1c1c;
      --muted:#b0b0b0;
      --brand:#007bff;
      --brand-2:#6c757d;
      --danger:#dc3545;
      --ring: 0 0 0 4px rgba(0, 123, 255, .3);
      --border:#444;
      --shadow: 0 8px 24px rgba(0,0,0,.3);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      background:var(--bg); color:#fff;
    }
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .main-header{text-align:center;margin:16px 0 24px}
    .main-header img{height:100px;margin-bottom:8px}
    .main-header h1{font-size:clamp(24px,3.2vw,36px);margin:0;color:#fff}
    .shop-info-sub{font-size:14px;color:var(--muted)}

    .grid{display:grid;grid-template-columns:1fr;gap:20px}
    @media(min-width:720px){.grid{grid-template-columns:2fr 1.4fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;box-shadow:var(--shadow);transition:transform 0.3s ease-in-out;}
    .card:hover {transform: translateY(-5px);}
    .section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .section-title h2{font-size:20px;margin:0;color:#fff}
    .muted{opacity:.8}

    .gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media(min-width:600px){.gallery{grid-template-columns:repeat(4,1fr)}}
    .swatch{position:relative;border:1px solid var(--border);border-radius:8px;overflow:hidden;cursor:pointer;background:#242424;transition:transform .2s, box-shadow .2s}
    .swatch:hover{transform:translateY(-5px);box-shadow:0 8px 15px rgba(0,0,0,.2);}
    .swatch img{width:100%;height:100px;object-fit:cover;display:block}
    .swatch .name{position:absolute;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);backdrop-filter:blur(2px);padding:6px 8px;font-size:13px;text-align:center;font-weight:500;color:#fff;border-top:1px solid rgba(255,255,255,.1);}
    .swatch.active{outline:2px solid var(--brand);box-shadow:var(--ring);}
    .swatch-info{font-size:11px; font-weight:700; color:white; background:#007bff; padding:3px 6px; border-radius:4px; position:absolute; top:6px; left:6px;}

    .preview-img{width:100%;border-radius:8px;border:1px solid var(--border);overflow:hidden;background:#242424}
    .preview-img img{width:100%;height:300px;object-fit:cover;display:block}

    .tabs{display:flex;gap:8px;margin:12px 0}
    .tab{flex:1;text-align:center;padding:10px;border-radius:8px;border:1px solid var(--border);background:#242424;cursor:pointer;font-weight:500;color:var(--muted);transition:background .2s, border-color .2s, box-shadow 0.2s}
    .tab.active{background:var(--brand);color:#fff;border-color:var(--brand);box-shadow:var(--ring)}

    label{display:block;font-size:14px;margin-top:12px;margin-bottom:6px;color:#fff}
    input[type="text"], select, input[type="number"]{
      width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:#242424;color:#fff;font-size:16px;
    }
    .form-grid{display:grid;grid-template-columns:1fr;gap:15px}
    @media(min-width:480px){.form-grid{grid-template-columns:1fr 1fr}}

    .btn{appearance:none;border:0;padding:12px 18px;border-radius:8px;cursor:pointer;font-weight:600;font-size:16px;transition:background .2s, color .2s, transform 0.2s;}
    .btn:active {transform: scale(0.98);}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-outline{background:transparent;color:var(--brand);border:1px solid var(--brand)}
    .btn-danger{background:var(--danger);color:#fff}

    .list{margin-top:16px;border-top:1px dashed var(--border);padding-top:12px}
    .item{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px dashed var(--border);font-size:15px}
    .badge{font-size:13px;padding:4px 10px;border-radius:999px;background:#333;color:#fff;margin-left:8px;font-weight:500}
    .pill{background:#007bff;color:#fff;padding:4px 10px;border-radius:999px;margin-left:8px;font-weight:500}

    .summary{font-size:15px;line-height:1.6;white-space:pre-wrap;font-family:monospace}
    .footer-actions{display:flex;flex-direction:column;gap:12px;margin-top:20px}
    @media(min-width:560px){.footer-actions{flex-direction:row;justify-content:flex-end}}
    .footer-actions-pdf{
        display:flex; flex-direction:row; gap:12px;
        margin-top:20px;
    }
    
    .hint{font-size:13px;opacity:.8}
    .totals{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
    .totals .chip{border:1px solid var(--border);border-radius:999px;padding:8px 12px;background:#242424;font-weight:500;font-size:14px;color:#fff}
    .totals strong{color:#fff}
    .text-center{text-align:center}
    .summary-heading {
      font-weight: bold;
      text-decoration: underline;
      margin-top: 10px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="main-header">
      <img src="logo.png" alt="PLUSPOINT EXCLUSIVE Logo" onerror="this.style.display='none'">
      <h1>PLUS POINT</h1>
    </header>

    <div class="grid">
      <section class="card">
        <div class="section-title">
          <h2>Colour Chart</h2>
          <span class="hint">Tap to preview & add</span>
        </div>
        <div id="gallery" class="gallery" aria-label="Colour gallery"></div>
      </section>

      <section class="card">
        <div class="section-title">
          <h2>Preview & Add</h2>
          <span id="currentColour" class="badge">No colour selected</span>
        </div>
        <div class="preview-img" aria-live="polite">
          <img id="previewImg" alt="Preview" src="" />
        </div>

        <div class="card" style="margin-top:20px; background:var(--bg);">
          <div class="section-title">
            <h2>Customer Details</h2>
          </div>
          <label for="customerName">Your Name</label>
          <input id="customerName" type="text" placeholder="e.g. Rahul Patel" autocomplete="name" required />
          <label for="customerPhone">Your Mobile Number</label>
          <input id="customerPhone" type="tel" placeholder="e.g. 9876543210" autocomplete="tel" required />
        </div>

        <div class="tabs">
          <button class="tab active" data-tab="person">Person‑wise</button>
          <button class="tab" data-tab="size">Size + Qty</button>
        </div>

        <form id="personForm" data-tabpanel="person">
          <div class="form-grid">
            <div>
              <label for="pName">Person Name</label>
              <input id="pName" type="text" placeholder="e.g. Vikram Patel " autocomplete="name" />
            </div>
            <div>
              <label for="pSize">Size</label>
              <select id="pSize"></select>
            </div>
          </div>
          <div>
            <label for="pQty">Qty</label>
            <input id="pQty" type="number" min="1" value="1" />
          </div>
          <div style="margin-top:16px;">
            <button type="submit" class="btn btn-primary" style="width:100%">Add Person</button>
          </div>
        </form>

        <form id="sizeForm" class="hidden" data-tabpanel="size" style="display:none">
          <div class="form-grid">
            <div>
              <label for="sSize">Size</label>
              <select id="sSize"></select>
            </div>
            <div>
              <label for="sQty">Qty</label>
              <input id="sQty" type="number" min="1" value="1" />
            </div>
          </div>
          <div style="margin-top:16px;">
            <button type="submit" class="btn btn-primary" style="width:100%">Add Size Qty</button>
          </div>
        </form>

        <div class="list" id="lineItems"></div>
      </section>
    </div>

    <section class="card" style="margin-top:20px">
      <div class="section-title">
        <h2>Order Summary</h2>
        <span class="hint">Auto‑grouped by colour & size</span>
      </div>
      <div id="summary" class="summary"></div>
      <div class="totals" id="totals"></div>
      <div class="footer-actions-pdf">
        <button id="copyBtn" class="btn btn-outline">Copy Order Text</button>
        <button id="waBtn" class="btn btn-primary">Send on WhatsApp</button>
      </div>
      <div class="footer-actions">
        <button id="downloadPdfBtn" class="btn btn-outline">Download Order PDF</button>
        <button id="clearBtn" class="btn btn-danger">Clear All</button>
      </div>
    </section>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    /* ===================== CONFIG ===================== */
    const WHATSAPP_NUMBER = "919722609460";
    const SHOP_NAME = "PLUSPOINT EXCLUSIVE Men'swear";
    const SHOP_CONTACT = "8866244409";
    const SHOP_ADDRESS = "Garden Road, Chikhli, Navsari, Gujarat";

    const KIDS_SIZES = ["24", "26", "28", "30", "32", "34"];
    const ADULT_SIZES = ["S", "M", "L", "XL", "XXL", "3XL"];

    const COLOURS = [
      {name:"Airforce",      img:"images/Airforce.jpg",      availableSizes:[...ADULT_SIZES, ...KIDS_SIZES]},
      {name:"Black",         img:"images/Black.jpg",         availableSizes:[...ADULT_SIZES, ...KIDS_SIZES]},
      {name:"Brown",         img:"images/Brown.jpg",         availableSizes:ADULT_SIZES},
      {name:"Dark Grey",     img:"images/Dark Grey.jpg",     availableSizes:ADULT_SIZES},
      {name:"Dark Red",      img:"images/Dark Red.jpg",      availableSizes:ADULT_SIZES},
      {name:"Dusty Purple",  img:"images/Dusty Purple.jpg",  availableSizes:[...ADULT_SIZES, ...KIDS_SIZES]},
      {name:"Lavender",      img:"images/LAVENDER.jpg",      availableSizes:ADULT_SIZES},
      {name:"Light Green",   img:"images/LIGHT GREEN.jpg",      availableSizes:[...ADULT_SIZES, ...KIDS_SIZES]},
      {name:"Light Grey",    img:"images/Light Grey.jpg",    availableSizes:[...ADULT_SIZES, ...KIDS_SIZES]},
      {name:"Navy",          img:"images/Navy.jpg",          availableSizes:ADULT_SIZES},
      {name:"Peach",         img:"images/Peach.jpg",         availableSizes:ADULT_SIZES},
      {name:"Rust",          img:"images/Rust.jpg",          availableSizes:ADULT_SIZES},
      {name:"Sky Blue",      img:"images/Sky Blue.jpg",      availableSizes:[...ADULT_SIZES, ...KIDS_SIZES]},
      {name:"Space Blue",    img:"images/Space Blue.jpg",    availableSizes:ADULT_SIZES},
      {name:"White",         img:"images/White.jpg",         availableSizes:[...ADULT_SIZES, ...KIDS_SIZES]},
      {name:"Lemon Yellow",  img:"images/Yellow.jpg",        availableSizes:ADULT_SIZES}
    ];

    /* ================ STATE ================ */
    let selectedColour = null;
    let lines = [];

    const $ = sel => document.querySelector(sel);
    const gallery = $('#gallery');
    const previewImg = $('#previewImg');
    const currentColourBadge = $('#currentColour');
    const customerName = $('#customerName');
    const customerPhone = $('#customerPhone');
    const pName = $('#pName');
    const pSize = $('#pSize');
    const pQty = $('#pQty');
    const sSize = $('#sSize');
    const sQty  = $('#sQty');
    const lineItems = $('#lineItems');
    const summaryBox = $('#summary');
    const totalsBox  = $('#totals');
    const downloadPdfBtn = $('#downloadPdfBtn');
    
    function fillSizeOptions(select, sizes){
      select.innerHTML = sizes.map(s=>`<option value="${s}">${s}</option>`).join('');
    }

    function renderGallery(){
      gallery.innerHTML = COLOURS.map((c,idx)=>{
        const isKids = c.availableSizes.some(s => KIDS_SIZES.includes(s));
        const kidsTag = isKids ? `<span class="swatch-info">KIDS</span>` : '';
        return `<button class="swatch" data-idx="${idx}" title="${c.name}">
                  ${kidsTag}
                  <img alt="${c.name}" src="${c.img}" onerror="this.style.opacity=.15;this.alt='No image'"/>
                  <span class="name">${c.name}</span>
                </button>`
      }).join('');
      gallery.querySelectorAll('.swatch').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const idx = +btn.dataset.idx;
          selectColour(COLOURS[idx]);
          gallery.querySelectorAll('.swatch').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
        });
      });
    }

    function selectColour(c){
      selectedColour = c;
      currentColourBadge.textContent = c ? c.name : 'No colour selected';
      previewImg.src = c?.img || '';
      fillSizeOptions(pSize, c.availableSizes);
      fillSizeOptions(sSize, c.availableSizes);
    }

    document.querySelectorAll('.tab').forEach(t=>{
      t.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const target = t.dataset.tab;
        document.querySelectorAll('[data-tabpanel]').forEach(p=>{
          p.style.display = (p.dataset.tabpanel===target)?'block':'none';
        });
      });
    });

    $('#personForm').addEventListener('submit', e=>{
      e.preventDefault();
      if(!selectedColour){alert('Please select a colour first.');return}
      const name = (pName.value||'').trim();
      const size = pSize.value; 
      const qty = Math.max(1, +pQty.value || 1);
      if(!customerName.value || !customerPhone.value){alert('Please enter your name and mobile number first.');return}
      if(!name){alert('Enter person name'); return}
      addLine({type:'person', name, size, qty});
      pName.value=''; pQty.value=1; pName.focus();
    });

    $('#sizeForm').addEventListener('submit', e=>{
      e.preventDefault();
      if(!selectedColour){alert('Please select a colour first.');return}
      const size = sSize.value; 
      const qty = Math.max(1, +sQty.value || 1);
      if(!customerName.value || !customerPhone.value){alert('Please enter your name and mobile number first.');return}
      addLine({type:'size', size, qty});
      sQty.value=1;
    });

    function addLine(partial){
      const id = crypto.randomUUID();
      lines.push({id, colour:selectedColour.name, ...partial});
      renderLines();
    }

    function removeLine(id){
      lines = lines.filter(l=>l.id!==id);
      renderLines();
    }

    function renderLines(){
      lineItems.innerHTML = lines.length? lines.map(l=>{
        const tag = (l.type === 'person') ? `<span class="pill">${l.name}</span>` : `<span class="pill">Bulk</span>`;
        return `<div class="item">
                  <div>
                    <strong>${l.colour}</strong>
                    ${tag}
                    <span class="badge">${l.size}</span>
                    <span class="badge">${l.qty} pc</span>
                  </div>
                  <button class="btn btn-danger" data-del="${l.id}">Remove</button>
                </div>`
      }).join('') : '<p class="muted text-center">No items added yet.</p>';

      lineItems.querySelectorAll('[data-del]').forEach(b=>{
        b.addEventListener('click',()=>removeLine(b.dataset.del));
      });

      const {text, totals} = buildSummaryText();
      summaryBox.textContent = text;
      totalsBox.innerHTML = totals.map(t=>`<span class="chip">${t.label}: <strong>${t.value}</strong></span>`).join('');
    }

    function groupBy(arr, key){
      return arr.reduce((acc,cur)=>{
        const k = key(cur);
        (acc[k] ||= []).push(cur); return acc;
      },{});
    }

    function buildSummaryText(){
      if(lines.length===0) return {text:'Add items to see summary.', totals:[]};
      const byColour = groupBy(lines, l=>l.colour);
      let out = [];
      let grandTotal = 0;

      Object.entries(byColour).forEach(([colour, items])=>{
        out.push(`${colour}:`);
        
        // Group all items by size
        const sizeGroups = groupBy(items, i => i.size);
        
        Object.entries(sizeGroups).forEach(([size, sizeItems]) => {
            const totalQty = sizeItems.reduce((sum, item) => sum + item.qty, 0);
            out.push(`(${size}-${totalQty})`);
            
            // List person-wise items first
            sizeItems.filter(i => i.type === 'person').forEach(p => {
                out.push(`  - ${p.name} - ${p.size} (${p.qty} pc)`);
            });

            // List bulk items
            sizeItems.filter(i => i.type === 'size').forEach(b => {
                out.push(`  - Bulk - ${b.size} (${b.qty} pc)`);
            });
        });

        grandTotal += items.reduce((sum, item) => sum + item.qty, 0);
      });
      out.push(`\nTotal: ${grandTotal} pcs`);
      return {text: out.join('\n'), totals:[{label:'Total Pcs', value:grandTotal},{label:'Colours', value:Object.keys(byColour).length},{label:'Lines', value:lines.length}]};
    }

    function buildWhatsAppText(){
      const customerInfo = `*ग्राहक का नाम:* ${customerName.value}\n*मोबाइल नंबर:* ${customerPhone.value}\n\n`;
      const header = `*Chinese Collar T-shirt – Order*`;
      const shopInfo = `\n\n*PLUSPOINT EXCLUSIVE Men'swear*\nAddress: Garden Road, Chikhli, Navsari, Gujarat`;
      const {text} = buildSummaryText();
      return `${customerInfo}${header}\n\n${text}\n${shopInfo}`.trim();
    }
    
    function buildPdfContent(doc) {
        let y = 20;

        doc.setFontSize(22);
        doc.text("PLUSPOINT", 105, y, { align: "center" });
        y += 10;
        doc.setFontSize(10);
        doc.text("Garden Road, Chikhli, Navsari, Gujarat", 105, y, { align: "center" });
        y += 20;

        doc.setFontSize(16);
        doc.text("Order Summary", 10, y);
        y += 10;
        doc.setFontSize(12);

        doc.text(`Customer Name: ${customerName.value}`, 10, y);
        y += 7;
        doc.text(`Mobile Number: ${customerPhone.value}`, 10, y);
        y += 15;

        if (lines.length > 0) {
            const byColour = groupBy(lines, l => l.colour);
            Object.entries(byColour).forEach(([colour, items]) => {
                doc.setFontSize(14);
                doc.text(`${colour}:`, 10, y);
                y += 7;

                const sizeGroups = groupBy(items, i => i.size);
                Object.entries(sizeGroups).forEach(([size, sizeItems]) => {
                    const totalQty = sizeItems.reduce((sum, item) => sum + item.qty, 0);
                    doc.setFontSize(12);
                    doc.text(`  (${size}-${totalQty})`, 10, y);
                    y += 7;

                    sizeItems.filter(i => i.type === 'person').forEach(p => {
                        doc.text(`    - ${p.name} - ${p.size} (${p.qty} pc)`, 10, y);
                        y += 7;
                    });
                    sizeItems.filter(i => i.type === 'size').forEach(b => {
                        doc.text(`    - Bulk - ${b.size} (${b.qty} pc)`, 10, y);
                        y += 7;
                    });
                });
                y += 5;
            });
            
            const grandTotal = lines.reduce((sum, item) => sum + item.qty, 0);
            doc.setFontSize(14);
            doc.text(`Total: ${grandTotal} pcs`, 10, y);
        } else {
            doc.text("No items added yet.", 10, y);
        }
    }

    $('#copyBtn').addEventListener('click', async()=>{
      const txt = buildWhatsAppText();
      try{ await navigator.clipboard.writeText(txt); alert('Order text copied!'); }
      catch{ alert('Copy failed. Long-press to select & copy.'); }
    });

    $('#waBtn').addEventListener('click', ()=>{
      if(lines.length===0){alert('Please add at least one item.');return}
      const msg = encodeURIComponent(buildWhatsAppText());
      const url = WHATSAPP_NUMBER
        ? `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`
        : `https://wa.me/?text=${msg}`;
      window.open(url, '_blank');
    });

    $('#clearBtn').addEventListener('click', ()=>{
      if(confirm('Clear all items?')){ lines=[]; renderLines(); }
    });
    
    downloadPdfBtn.addEventListener('click', () => {
        if(lines.length === 0){
            alert('Please add at least one item to download PDF.');
            return;
        }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        buildPdfContent(doc);
        doc.save("order-summary.pdf");
    });

    renderGallery();
    if(COLOURS.length){ selectColour(COLOURS[0]); gallery.querySelector('.swatch')?.classList.add('active'); }
    renderLines();
  </script>
</body>
</html>
